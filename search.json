---
layout:
---
{%
  assign _words = ""
  %}{%
  assign _wordlists = "" | split: ","
%}{ "pages": [
  {% for page in site.documents %}{% capture codeblock %}
    {% assign _content = page.content | markdownify | strip_html | remove: site.excerpt_separator | strip %}

    {% if _content contains site.excerpt_separator %}
      {% assign _blurb = _content | split: site.excerpt_separator | first %}
    {% else %}
      {% assign _blurb = _content | truncatewords: 250 %}
    {% endif %}

    {% assign _wordlist = _content
      | downcase
      | remove: '!'
      | remove: '"'
      | remove: '#'
      | remove: '$'
      | remove: '%'
      | remove: '&'
      | remove: '('
      | remove: ')'
      | remove: '*'
      | remove: '+'
      | remove: ','
      | remove: '-'
      | remove: ';'
      | remove: '='
      | remove: '?'
      | remove: '“'
      | remove: '”'
      | replace: "‘", "'"
      | replace: "’", "'"
      | replace: "'s ", " "
      | replace: " '", " "
      | replace: "' ", " "
      | replace: '. ', ' '
      | replace: '. ', ' '
      | replace: '/', ' '
      | replace: ': ', ' '
      | split: ' '
      | sort
      | uniq
      | where_exp: "item", "item.size > 3"
      | where_exp: "item", "item.size < 10"
      %}
    {% assign _wordlist_string = _wordlist | join: ',' %}

    {% assign _words = _words | append: "," | append: _wordlist_string %}
    {% assign _wordlists = _wordlists | push: _wordlist %}

    {% assign _id = forloop.index | minus: 1 %}

    {% endcapture %}{% assign codeblock = nil %}
    {
      "id": {{ _id }},
      "title": {{ page.title | strip | jsonify }},
      "slug": {{ page.slug | strip | jsonify }},
      "url": "{{ site.baseurl }}{{ page.url }}",
      "category": {{ page.category | join: "," | strip | jsonify }},
      "tags": {{ page.tags | join: "," | strip | replace: ", ", "," | replace: ",,", "," | downcase | split: "," | sort | uniq | jsonify }},
      "date"     : "{{ page.date | date_to_xmlschema }}",
      "wordcount": {{ _content | remove: site.excerpt_separator | number_of_words }},
      "wordlist": {{ _wordlist | join: " " | jsonify }},
      "excerpt": {{ _blurb | jsonify }}
     }{% unless forloop.last %},{% endunless %}
    {% comment %}
    {% endcomment %}
  {% endfor %}

{% comment %}
],

{% assign _words_full = _words | split: "," | sort | uniq %}
"words": [ {%
  for _word in _words_full %}{%
    if _word contains "a" or _word contains "e" or _word contains "i" or _word contains "o" or _word contains "u" %}{%
    assign word_size = _word | size %}{%
    if word_size > 2 and word_size < 10 %}
      { {{ _word | jsonify }}: [ {%
        capture pagelist %}{%
          for _wordlist in _wordlists %}{%
            if _wordlist contains _word %},{{
              forloop.index }}{%
            endif %}{%
          endfor %} ]}{%
        endcapture %}{{ pagelist | remove_first: ',' }}{%
      unless forloop.last %},{% endunless %}{%
    endif %}{%
    endif %}{%
  endfor %}
{% endcomment %}
]

}


